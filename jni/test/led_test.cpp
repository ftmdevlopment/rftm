//
// Created by dev on 16-12-7.
//

#include <fcntl.h>

#include "led_test.h"

#define ALOGD XLOGI

void LedTest::RunTest()
{
    unsigned char white_color[42] = {
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
    };
    unsigned char red_color[42] = {
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0x00, 0x00, 0xff, 0x00, 0x00, 0xff,
            0x00, 0x00, 0xff, 0x00, 0x00, 0xff,
            0x00, 0x00, 0xff, 0x00, 0x00, 0xff,
            0x00, 0x00, 0xff, 0x00, 0x00, 0xff,
    };
    unsigned char green_color[42] = {
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
            0x00, 0xff, 0x00, 0x00, 0xff, 0x00,
            0x00, 0xff, 0x00, 0x00, 0xff, 0x00,
            0x00, 0xff, 0x00, 0x00, 0xff, 0x00,
            0x00, 0xff, 0x00, 0x00, 0xff, 0x00,
    };
    unsigned char zero_buf[42] = {0};

    int fd, ret;
    fd = open("/dev/dm163", O_RDWR | O_NONBLOCK);
    if (fd < 0) {
        ALOGD("Failed to open /dev/dm163");
        return;
    }

    ret = write(fd, red_color, sizeof(red_color));
    if (ret < 0) {
        ALOGD("Failed to write /dev/dm163");
        goto exit;
    }
    result("LED Red");
    sleep(2);

    ret = write(fd, green_color, sizeof(green_color));
    if (ret < 0) {
        ALOGD("Failed to write /dev/dm163");
        goto exit;
    }
    result("LED Green");
    sleep(2);

    ret = write(fd, white_color, sizeof(white_color));
    if (ret < 0) {
        ALOGD("Failed to write /dev/dm163");
        goto exit;
    }
    result("LED White");
    sleep(2);

    ret = write(fd, zero_buf, sizeof(zero_buf));
    if (ret < 0) {
        ALOGD("Failed to write /dev/dm163");
        goto exit;
    }
    result("turn off LED");
    sleep(2);

exit:
    close(fd);
}

